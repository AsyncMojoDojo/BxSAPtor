using System;
using System.Collections.Concurrent;
//•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
namespace MsgHub
	{
		internal sealed class Subscriptions
			{
				#region **[Declarations]**

					private readonly string																				cc_Topic;
					private readonly ConcurrentDictionary<Guid, Subscription>	ct_Subscriptions;		// key	= subscription id

				#endregion
				//_________________________________________________________________________________________
				#region **[Properties]**

					public string		Topic { get { return this.cc_Topic; } }
					public int			Count { get { return this.ct_Subscriptions.Count; } }

					//public ConcurrentDictionary<Guid, Subscription>	Subscribers { get { return this.ct_Subscriptions; } }

				#endregion
				//_________________________________________________________________________________________
				#region **[Constructors]**

					//¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
					internal Subscriptions(string Topic)
						{
							this.cc_Topic						= Topic;
							this.ct_Subscriptions		= new ConcurrentDictionary<Guid, Subscription>();
						}

				#endregion
				//_________________________________________________________________________________________
				#region **[Methods:Exposed]**

					//¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
					public void Clear()
						{
							this.ct_Subscriptions.Clear();
						}

					//¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
					public bool ContainsKey(Guid SubscriptionToken)
						{
							return this.ct_Subscriptions.ContainsKey(SubscriptionToken);
						}

					//¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
					public Guid Register(Subscription Subscription)
						{
							return	this.Register(Subscription.MyToken,	Subscription);
						}
					
					//¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
					public Guid Register(Guid SubscriptionToken, Subscription Subscription)
						{
							this.ct_Subscriptions.AddOrUpdate(SubscriptionToken	, 
																								Subscription			,
																								(key, OldVal) => Subscription );
							return	SubscriptionToken;
						}

					//¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
					public bool RemoveSubscription(Guid SubscriptionToken)
						{
							Subscription lo_Sub;
							return	this.ct_Subscriptions.TryRemove(SubscriptionToken, out lo_Sub);
						}

				#endregion
			}
	}
